(window.webpackJsonp=window.webpackJsonp||[]).push([[445],{2215:function(e,t,n){"use strict";n.r(t);var r=n(1),c=(n(25),n(16),n(20),n(23)),o=n.n(c),d=n(189),l=n(232),m=n(21),v=n(462),w=n(75);function h(){return y.apply(this,arguments)}function y(){return y=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:0,m.a.debug("Handling UserSignup UTM params"),!(t>30)){e.next=6;break}throw new Error("Failed to set up user");case 6:t++;case 7:return e.next=9,new Promise((function(e){return setTimeout(e,1e3)}));case 9:if(n=window.$nuxt.$api){e.next=12;break}return e.abrupt("return");case 12:if(r={utm_source:o.a.get("utm_source")||"empty",utm_medium:o.a.get("utm_medium")||"(not set)",utm_campaign:o.a.get("utm_campaign")||void 0,currency:o.a.get("currency")||null,language:o.a.get("language")||void 0,cobrand:o.a.get(v.a)||void 0,country:o.a.get("country")||void 0},0!==Object.keys(r).length){e.next=15;break}return e.abrupt("return");case 15:return e.prev=15,e.next=18,n.patch("/api/v3/users/me",r);case 18:e.next=26;break;case 20:if(e.prev=20,e.t0=e.catch(15),e.t0.response){e.next=24;break}throw e.t0;case 24:if(404!==e.t0.response.status){e.next=26;break}return e.abrupt("return",h(t));case 26:case"end":return e.stop()}}),e,null,[[15,20]])}))),y.apply(this,arguments)}l.a.$on(d.a.UserSignedIn,(function(e){var t,n,r=e.user,c=e.method,v=e.enterprise,h=e.track_analytics,y=void 0===h||h;(m.a.debug("Handling UserSignedIn",r),w.c.identify(r.id),w.c.registerGlobalProperties({plan_level:r.plan.package.code}),y&&(w.c.track(w.a.LOGIN,{method:c}),l.a.$emit(d.a.AnalyticsGA4Event,{event:"login",userId:r.id,method:c})),null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser({id:r.id,email:r.email}),v.is_whitelabel)||(o.a.get("currency")!==r.currency&&(o.a.set("currency",r.currency),l.a.$emit(d.a.CurrencyChange,r.currency)),o.a.remove("unauthed_cart"))})),l.a.$on(d.a.UserRegistered,function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,c,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=t.user,v=t.method,t.enterprise,m.a.debug("Handling UserRegistered",c),w.c.identify(c.id),h().catch((function(e){return m.a.error(e)})),l.a.$emit(d.a.AnalyticsGA4Event,{event:"sign_up",userId:c.id,method:v}),w.c.registerGlobalProperties({plan_level:c.plan.package.code}),w.c.track(w.a.SIGNUP,{method:v,email:c.email}),null===(n=window.$nuxt)||void 0===n||null===(r=n.$sentry)||void 0===r||r.setUser({id:c.id,email:c.email}),o.a.remove("unauthed_cart");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l.a.$on(d.a.UserUpdatedAttributes,(function(e){var t,n,r=e.user,c=e.enterprise;m.a.debug("Handling UserUpdatedAttributes",r),o.a.remove("unauthed_cart"),c.is_whitelabel||(r.given_name||r.family_name)&&(null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser({id:r.id,email:r.email}))})),l.a.$on(d.a.UserSignedOut,(function(e){var t,n,r=e.enterprise;m.a.debug("Handling UserSignedOut"),null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser(null),r.is_whitelabel||(w.c.track(w.a.LOGOUT),w.c.reset())}))}}]);
//# sourceMappingURL=d4d815a.js.map